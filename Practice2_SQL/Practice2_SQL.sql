CREATE DATABASE QLSV

CREATE TABLE KHOA
(
	MAKHOA CHAR(10) PRIMARY KEY,
	TENKHOA CHAR(30),
	DIENTHOAI CHAR(10)
)

CREATE TABLE GIANGVIEN
(
	MAGV INT PRIMARY KEY,
	HOTENGV CHAR(30),
	LUONG DECIMAL(5,2),
	MAKHOA CHAR(10),
)

CREATE TABLE SINHVIEN
(
	MASV INT PRIMARY KEY,
	HOTENSV CHAR(30),
	MAKHOA CHAR(10),
	NAMSINH INT,
	QUEQUAN CHAR(30)
)

CREATE TABLE DETAI
(
	MADT CHAR(10) PRIMARY KEY,
	TENDT CHAR(30),
	KINHPHI INT,
	NOITHUCTAP CHAR(30),
)

CREATE TABLE HUONGDAN
(
	MASV INT ,
	MADT CHAR(10),
	MAGV INT,
	KETQUA DECIMAL(5,2),
	PRIMARY KEY (MASV,MADT,MAGV)
)

ALTER TABLE GIANGVIEN ADD CONSTRAINT FK_GV_KHOA  FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)

ALTER TABLE	SINHVIEN ADD CONSTRAINT FK_SV_KHOA FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)

ALTER TABLE HUONGDAN ADD
CONSTRAINT FK_HD_SV FOREIGN KEY (MASV) REFERENCES SINHVIEN(MASV),
CONSTRAINT FK_HD_DT FOREIGN KEY (MADT) REFERENCES DETAI(MADT), 
CONSTRAINT FK_HD_GV FOREIGN KEY (MAGV) REFERENCES GIANGVIEN(MAGV) 


INSERT INTO KHOA (MAKHOA, TENKHOA, DIENTHOAI) 
VALUES
('K001', 'DIALY', '0123456789'),
('K002', 'QLTN', '0987654321'),
('K003', 'CONG NGHE SINH HOC', '0369876542'),
('K004', 'TOAN', '0912345678'),
('K005', 'LUAT', '0654321098')

INSERT INTO GIANGVIEN (MAGV, HOTENGV, LUONG, MAKHOA)
VALUES 
(1, 'Nguyen Van A', 500, 'K001'),
(2, 'Tran Thi B', 450, 'K002'),
(3, 'Tran son', 600, 'K003'),
(4, 'Pham Thanh D', 550, 'K004'),
(5, 'Hoang van e', 480, 'K005'),
(6, 'Nguyen Thi F', 520, 'K001'),
(7, 'Tran Van G', 470, 'K002'),
(8, 'Le Thi H', 510, 'K003'),
(9, 'Pham Van I', 460, 'K004'),
(10, 'Hoang Thi K', 530, 'K005')

INSERT INTO SINHVIEN (MASV, HOTENSV, MAKHOA, NAMSINH, QUEQUAN)
VALUES
(1, 'Nguyen Thi A', 'K001', 2000, 'Ha Noi'),
(2, 'Tran Van B', 'K002', 2001, 'Hai Phong'),
(3, 'Le van son', 'K003', 1999, 'Đa Nang'),
(4, 'Pham Thanh D', 'K004', 2000, 'Ho Chi Minh'),
(5, 'Hoang Van E', 'K005', 1999, 'Can Tho'),
(6, 'Nguyen Thi F', 'K001', 2001, 'Hai Duong'),
(7, 'Tran Van G', 'K002', 2000, 'Thanh Hoa'),
(8, 'Le Thi H', 'K003', 1999, 'Nghe An'),
(9, 'Pham Van I', 'K004', 2001, 'Hung Yen'),
(10, 'Hoang Thi K', 'K005', 2000, 'Bac Giang'),
(11, 'Nguyen Van L', 'K001', 1999, 'Hoa Binh'),
(12, 'Tran Thi M', 'K002', 2000, 'Quang Ninh'),
(13, 'Le Van N', 'K003', 2001, 'Thai Binh'),
(14, 'Pham Thanh O', 'K004', 1999, 'Bac Ninh'),
(15, 'Hoang Van P', 'K005', 2000, 'Lang Son'),
(16, 'Nguyen Tha Q', 'K001', 2001, 'Nam Đinh'),
(17, 'Tran Van R', 'K002', 1999, 'Vinh Phuc'),
(18, 'Le Thi S', 'K003', 2000, 'Thai Nguyen'),
(19, 'Pham Van T', 'K004', 2001, 'Bac Kan'),
(20, 'Hoang Thi U', 'K005', 1999, 'Phu Tho')


INSERT INTO DETAI (MADT, TENDT, KINHPHI, NOITHUCTAP)
VALUES
('DT001', 'Đề tài 1', 5000000, 'Ha Noi'),
('DT002', 'Đề tài 2', 7000000, 'Ho Chi Minh'),
('DT003', 'Đề tài 3', 4000000, 'Da Nang'),
('DT004', 'Đề tài 4', 6000000, 'Hue'),
('DT005', 'Đề tài 5', 8000000, 'Hai Phong'),
('DT006', 'Đề tài 6', 5500000, 'Vung Tau'),
('DT007', 'Đề tài 7', 3500000, 'Can Tho'),
('DT008', 'Đề tài 8', 4500000, 'Quang Ninh'),
('DT009', 'Đề tài 9', 9000000, 'Nha Trang'),
('DT010', 'Đề tài 10', 7500000, 'Phu Quoc')

INSERT INTO HUONGDAN (MASV, MAGV, MADT, KETQUA) 
VALUES
(1, 1, 'DT001', 8.5),
(2, 2, 'DT002', 7.9),
(3, 1, 'DT003', 9.2),
(4, 2, 'DT004', 8.7),
(5, 2, 'DT005', 7.3),
(6, 1, 'DT006', 9.8),
(7, 3, 'DT007', 8.2),
(8, 2, 'DT008', 7.5),
(9, 1, 'DT009', 9.2),
(10, 3, 'DT001', 8.6),
(11, 2, 'DT001', 7.7),
(12, 4, 'DT002', 9.4),
(13, 1, 'DT003', 9.3),
(14, 4, 'DT004', 8.8),
(15, 2, 'DT005', 7.8),
(16, 5, 'DT006', 9.1),
(17, 1, 'DT007', 8.9),
(18, 5, 'DT008', 8.4)


-- 1. Đưa ra thông tin gồm mã số, họ tên và tên khoa của tất cả các giảng viên
SELECT MAGV, HOTENGV, TENKHOA
FROM GIANGVIEN
INNER JOIN KHOA ON GIANGVIEN.MAKHOA = KHOA.MAKHOA;

-- 2. Đưa ra thông tin gồm mã số, họ tên và tên khoa của các giảng viên của khoa 'DIA LY va QLTN'
SELECT MAGV, HOTENGV, TENKHOA
FROM GIANGVIEN
INNER JOIN KHOA ON GIANGVIEN.MAKHOA = KHOA.MAKHOA
WHERE TENKHOA='DIALY' OR TENKHOA='QLTN';

-- 3. Cho biết số sinh viên của khoa "CONG NGHE SINH HOC"
SELECT COUNT(MASV)
FROM SINHVIEN
INNER JOIN KHOA ON KHOA.MAKHOA = SINHVIEN.MAKHOA
WHERE KHOA.TENKHOA='CONG NGHE SINH HOC';


-- 4. Đưa ra danh sách gồm mã số, họ tên và tuổi của các sinh viên khoa 'TOAN'
SELECT MASV, HOTENSV, YEAR(GETDATE())-NAMSINH as TUOI
FROM SINHVIEN
INNER JOIN KHOA ON KHOA.MAKHOA=SINHVIEN.MAKHOA
WHERE KHOA.TENKHOA='TOAN';

-- 5. Cho biết số giảng viên của khoa 'CONG NGHE SINH HOC'
SELECT COUNT(MAGV)
FROM GIANGVIEN
INNER JOIN KHOA ON KHOA.MAKHOA=GIANGVIEN.MAKHOA
WHERE KHOA.TENKHOA = 'CONG NGHE SINH HOC'

-- 6. Cho biết thông tin về sinh viên không tham gia thực tập
SELECT * 
FROM SINHVIEN
EXCEPT
SELECT SINHVIEN.*
FROM SINHVIEN
INNER JOIN HUONGDAN ON HUONGDAN.MASV = SINHVIEN.MASV

-- 7. Đưa ra mã khoa, tên khoa và số lượng giảng viên mỗi khoa
SELECT KHOA.MAKHOA,KHOA.TENKHOA, COUNT(MAGV) AS SLGV
FROM KHOA
LEFT JOIN GIANGVIEN ON GIANGVIEN.MAKHOA = KHOA.MAKHOA
GROUP BY KHOA.MAKHOA, KHOA.TENKHOA


-- 8. Cho biết số điện thoại của khoa mà sinh viên có tên 'Le van son' đang theo học
SELECT KHOA.DIENTHOAI
FROM KHOA
INNER JOIN SINHVIEN ON SINHVIEN.MAKHOA=KHOA.MAKHOA
WHERE HOTENSV='Le van son'

-- 9. Cho biết mã số và tên các đề tài mà giảng viên 'Tran son' hướng dẫn
SELECT HUONGDAN.MADT, DETAI.TENDT
FROM HUONGDAN
INNER JOIN GIANGVIEN ON GIANGVIEN.MAGV = HUONGDAN.MAGV
INNER JOIN DETAI ON HUONGDAN.MADT = DETAI.MADT
WHERE HOTENGV='Tran son'

-- 10. Cho biết đề tài nào không có sinh viên thực tập
/* --Cách 1
SELECT TENDT
FROM DETAI
LEFT JOIN HUONGDAN ON HUONGDAN.MADT = DETAI.MADT
GROUP BY TENDT
HAVING COUNT(HUONGDAN.MADT) = 0
*/

SELECT TENDT
FROM DETAI
LEFT JOIN HUONGDAN ON HUONGDAN.MADT = DETAI.MADT
WHERE MASV is null


-- 11.Cho biết mã số, họ tên, tên khoa của các giảng viên hướng dẫn từ 3 sinh viên trở lên
SELECT GIANGVIEN.MAGV, HOTENGV, KHOA.TENKHOA
FROM GIANGVIEN
INNER JOIN KHOA ON KHOA.MAKHOA=GIANGVIEN.MAKHOA
WHERE GIANGVIEN.MAGV IN (
SELECT MAGV
FROM HUONGDAN
GROUP BY MAGV
HAVING COUNT(MAGV) >= 3)

--12. Cho biết mã số, tên đề tài của đề tài có kinh phí cao nhất
SELECT MADT, TENDT
FROM DETAI
WHERE KINHPHI = (SELECT MAX(KINHPHI) FROM DETAI)

--13. Cho biết mã số và tên các đề tài có nhiều hơn 2 sinh viên tham gia thực tập
SELECT MADT, TENDT
FROM DETAI
WHERE MADT IN (
SELECT MADT
FROM HUONGDAN
GROUP BY MADT
HAVING COUNT(MADT)>2)

--14 Đưa ra mã số, họ tên và điểm của các sinh viên khoa 'DIALY và QLTN'
SELECT SINHVIEN.MASV, HOTENSV, HUONGDAN.KETQUA
FROM SINHVIEN
INNER JOIN HUONGDAN ON HUONGDAN.MASV = SINHVIEN.MASV
INNER JOIN KHOA ON SINHVIEN.MAKHOA=KHOA.MAKHOA
WHERE KHOA.TENKHOA in ('DIALY', 'QLTN')

-- 15. Đưa ra tên khoa, số lượng sinh viên mỗi khoa
SELECT TENKHOA, COUNT(KHOA.MAKHOA) AS SO_SINHVIEN
FROM KHOA
INNER JOIN SINHVIEN ON KHOA.MAKHOA = SINHVIEN.MAKHOA
GROUP BY KHOA.TENKHOA,KHOA.MAKHOA

-- 16. Cho biết thông tin về các sinh viên thực tập tại quê nhà
SELECT SINHVIEN.*
FROM SINHVIEN
INNER JOIN HUONGDAN ON HUONGDAN.MASV=SINHVIEN.MASV
INNER JOIN DETAI ON DETAI.MADT=HUONGDAN.MADT
WHERE SINHVIEN.QUEQUAN=DETAI.NOITHUCTAP

-- 17. Cho biết thông tin những sinh viên chưa có điểm thực tập
SELECT SINHVIEN.*
FROM SINHVIEN
LEFT JOIN HUONGDAN ON SINHVIEN.MASV = HUONGDAN.MASV
WHERE KETQUA IS NULL;

-- 18. Đưa ra danh sách gồm mã số, họ tên các sinh viên có điểm thực tập bằng 0
SELECT SINHVIEN.*
FROM SINHVIEN
INNER JOIN HUONGDAN ON SINHVIEN.MASV = HUONGDAN.MASV
WHERE KETQUA = 0;
